# Replicated Log

This project implements a replicated log system.

## Architecture Overview

### Master Server

The Master server provides the following API endpoint:

-  `POST /api/messages`: This endpoint allows you to append a message to the in-memory list, ensuring that the message is replicated on at least a specified number of Secondaries (or the Master itself) before the operation is considered complete.

    ##### Request Body
    The request should include a JSON object with the following parameters:

    ```json
    {
      "message": "Some message",
      "writeConcern": 3
    }
    ```
    - `message (string)`: The message you want to append to the list.
    - `writeConcern (integer)`: The writeConcern parameter specifies the level of acknowledgment (ACK) required from secondary nodes.
      - w=1: The Master node must receive an ACK only from itself.
      - w=2: The Master node must receive an ACK from itself and at least one secondary node.
      - w=3: The Master node must receive an ACK from itself and at least two secondary nodes.


- `GET /api/messages`: Retrieves all messages from the in-memory list.

- `GET /api/messages/all`: Retrieves all messages from all nodes in the cluster.

### Secondary Servers

Each Secondary server provides the following API:

- `POST /api/messages`: Appends a message to the in-memory list.

   ##### Request Body
   The request should include a JSON object with the following parameters:

    ```json
    {
      "message": "Some message",
      "requestId": 42
    }
    ```
    - `message (string)`: The message you want to append to the list.
    - `requestId (integer)`: A unique identifier generated by the Master server. This identifier ensures that messages are processed in the correct order and prevents duplicate operations when retries occur.

- `GET /api/messages`: Retrieves all replicated messages from the  in-memory list.

### Web Client

The Web Client serves as a user-friendly interface for interacting with the Master Server. It provides a more convenient and intuitive way to test and manage the replicated log system. Through the Web Client, users can easily send requests to the Master Server, view responses, and monitor the log's status.

The Web Client can be accessed via a web browser by reaching `http://localhost:8000`.

### Discovery Service

This service enables dynamic discovery of Secondary nodes and their respective URLs, allowing the system to adapt to changes in the cluster's configuration.

## Getting Started

### Prerequisites

Before running the system, make sure you have the following prerequisites installed:

- Docker
- Docker Compose

### Building and Running

1. Clone this repository to your local machine.

2. Start the cluster:

    ```shell
    docker-compose up --build
    ```

This will start the Master server and a specified number of Secondary servers (you can configure the number of Secondaries in the [compose.yaml](./compose.yaml) file).

## Testing

### Web Client

1. To test the system using the Web Client, open any web browser and enter [http://localhost:8000](http://localhost:8000) into the address bar. This action will bring up a page featuring the input fields.

2. You can now input any message into the provided field and either press the `Submit` button or simply hit `Enter`.  By default, the `writeConcern` parameter is set to 3, but you can easily adjust it if needed.
![img_7.png](img_7.png)

3. Upon submission, a new notification, or "toast," will appear in the top-right corner of the page, indicating the result of your request.

    - Initially, every message is in a "Pending" state and is denoted by a gray rectangle within the toast itself.

   ![img_8.png](img_8.png)

    - After the message has been successfully replicated to the specified number of Secondary nodes, the rectangle will turn green, and a corresponding status message will be displayed.

   ![img_9.png](img_9.png)

    - In the event of a failure to replicate the message or if the `writeConcern` parameter exceeds the number of nodes in the cluster, the interface will indicate this by changing the status indicator to red and displaying an associated error message.

   ![img_10.png](img_10.png)


4. The interface features a table where you can monitor the messages across all nodes within the cluster. Due to the inherent response delay of secondary nodes (also can be adjusted in [compose.yaml](./compose.yaml)), messages will appear sequentially in the table. This allows you to confirm that the notification rectangle will transition to a green status only after the message has been successfully replicated to the specified number of nodes.
![img_11.png](img_11.png)

    
